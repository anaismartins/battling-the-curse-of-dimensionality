---
title: 'Practical 8: Text Mining'
author: "Ana Martins"
date: "2023-01-13"
output: html_document
---

## 1 Introduction

```{r}
library(tidyverse)
library(tidytext)
library(tm)
library(e1071)
library(topicmodels)
library(stringi)
```

## 2 Vector space model: document-term matrix

**1. Use the code below to load the data set and inspect its first rows.**

```{r}
load("data/news_dataset.rda")
head(df_final)
```

**2. Find out about the name of the categories and the number of observations in each of them.**

```{r}
df_final <-
  df_final %>% 
  mutate(Category = as.factor(Category))

summary(df_final$Category)
```

**3. Convert the data set into a document-term matrix and use the findFreqTerms function to keep the terms which their frequency is higher than 10. It is also a good idea to apply some text preprocessing before this conversion: e.g., remove non-UTF-8 characters, convert the words into lowercase, remove punctuation, numbers, stopwords, and whitespaces.**

```{r}
dtm <-
  DocumentTermMatrix(df_final,
                     control = list(
                       removePunctuation = TRUE,
                       removeNumbers = TRUE,
                       stopwords = TRUE
                     ))

dtm <- findFreqTerms(dtm, 10)
```

**4. Partition the original data into training and test sets with 80% for training and 20% for test.**

```{r}
split <- sample(c(0, 1), nrow(df_final), replace = TRUE, prob = c(0.80, 0.20))

df_final <-
  df_final %>% 
  mutate(split = split)

df_final_train <-
  df_final %>% 
  filter(split == 0) %>% 
  select(-split)

df_final_test <-
  df_final %>% 
  filter(split == 1) %>% 
  select(-split)
```

**5. Create separate document-term matrices for the training and the test sets using the previous frequent terms as the input dictionary and convert them into data frames.**

```{r}
train_dtm <- DocumentTermMatrix(
  df_final_train,
  control = list(
    removePunctuation = TRUE,
    removeNumbers = TRUE,
    stopwords = TRUE
  )
)

test_dtm <- DocumentTermMatrix(
  df_final_test,
  control = list(
    removePunctuation = TRUE,
    removeNumbers = TRUE,
    stopwords = TRUE
  )
)
```

**6. OPTIONAL: Use the cbind function to add the categories to the train_dtm data and name the column y.**

```{r}
cbind(df_final$Category, train_dtm)
```

